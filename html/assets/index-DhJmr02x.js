(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const i of c)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function o(c){const i={};return c.integrity&&(i.integrity=c.integrity),c.referrerPolicy&&(i.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?i.credentials="include":c.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(c){if(c.ep)return;c.ep=!0;const i=o(c);fetch(c.href,i)}})();const d={D:{label:"DEBUG",color:"text-log-d",defaultColor:"Blue"},I:{label:"INFO",color:"text-log-i",defaultColor:"Green"},W:{label:"WARNING",color:"text-log-w",defaultColor:"Red"},E:{label:"ERROR",color:"text-log-e",defaultColor:"Orange"},V:{label:"VERBOSE",color:"text-log-v",defaultColor:"Cyan"},A:{label:"WTF",color:"text-log-a",defaultColor:"WTP"}},E=[1200,2400,4800,9600,19200,38400,57600,115200,230400,460800,921600],C=["Blue","Green","Red","Orange","Cyan","WTP"],f={Blue:"text-[#3b82f6]",Green:"text-[#22c55e]",Red:"text-[#ef4444]",Orange:"text-[#f59e0b]",Cyan:"text-[#2eaf9b]",WTP:"text-[#a855f7]"};let e={port:null,reader:null,writer:null,connected:!1,logs:[],settings:{baudRate:115200,showTimestamp:!0,showLogLevel:!0,autoScroll:!0,inputMode:"ASCII",lineEnding:`
`,hexBatchLines:!1,hexDelayEnabled:!0,hexDelay:100,useSystemTimestamp:!0,autoConnect:!0,appearanceMode:"default",levelConfigs:{D:{enabled:!0,color:"Blue",colorEnabled:!0},I:{enabled:!0,color:"Green",colorEnabled:!0},W:{enabled:!0,color:"Red",colorEnabled:!0},E:{enabled:!0,color:"Orange",colorEnabled:!0},V:{enabled:!0,color:"Cyan",colorEnabled:!0},A:{enabled:!0,color:"WTP",colorEnabled:!0}}}};const n={connectBtn:document.getElementById("connectBtn"),baudSelect:document.getElementById("baudRateSelect"),filterBtn:document.getElementById("filterBtn"),filterMenu:document.getElementById("filterMenu"),filterCheckboxes:document.getElementById("filterCheckboxes"),filterAllBtn:document.getElementById("filterAllBtn"),filterNoneBtn:document.getElementById("filterNoneBtn"),saveBtn:document.getElementById("saveBtn"),clearBtn:document.getElementById("clearBtn"),logContainer:document.getElementById("logContainer"),modeAsciiBtn:document.getElementById("modeAsciiBtn"),modeHexBtn:document.getElementById("modeHexBtn"),asciiOptions:document.getElementById("asciiOptions"),hexOptions:document.getElementById("hexOptions"),lineEndingSelect:document.getElementById("lineEndingSelect"),hexBatchLinesCheck:document.getElementById("hexBatchLinesCheck"),hexDelayCheck:document.getElementById("hexDelayCheck"),hexDelayInput:document.getElementById("hexDelayInput"),commandInput:document.getElementById("commandInput"),sendBtn:document.getElementById("sendBtn"),settingsBtn:document.getElementById("settingsBtn"),settingsModal:document.getElementById("settingsModal"),closeSettingsBtn:document.getElementById("closeSettingsBtn"),cancelSettingsBtn:document.getElementById("cancelSettingsBtn"),doneSettingsBtn:document.getElementById("doneSettingsBtn"),prefUseSystemTimestamp:document.getElementById("prefUseSystemTimestamp"),prefAutoConnect:document.getElementById("prefAutoConnect"),prefAppearanceDefault:document.getElementById("prefAppearanceDefault"),prefAppearanceCustom:document.getElementById("prefAppearanceCustom"),levelSettingsGrid:document.getElementById("levelSettingsGrid"),toast:document.getElementById("toast"),headerTime:document.getElementById("headerTime"),headerLevel:document.getElementById("headerLevel")};async function I(){const t=localStorage.getItem("timber_settings_v10");t&&(e.settings={...e.settings,...JSON.parse(t)}),n.baudSelect.innerHTML=E.map(l=>`<option value="${l}">${l}</option>`).join(""),n.baudSelect.value=e.settings.baudRate,m(),x(),b(),v(),k()}function m(){n.filterCheckboxes.innerHTML=Object.entries(d).map(([t,l])=>{var o,s;return`
                <label class="flex items-center gap-3 px-2 py-2 rounded hover:bg-surface-light cursor-pointer group">
                    <input type="checkbox" data-level="${t}" ${(o=e.settings.levelConfigs[t])!=null&&o.enabled?"checked":""} class="level-check w-4 h-4 bg-transparent border-border text-primary rounded focus:ring-0">
                    <span class="text-[11px] font-bold ${f[((s=e.settings.levelConfigs[t])==null?void 0:s.color)||"Blue"]}">${l.label}</span>
                </label>`}).join("")}function x(){n.levelSettingsGrid.innerHTML=Object.entries(d).map(([t,l])=>{const o=e.settings.levelConfigs[t]||{enabled:!0,color:"Blue",colorEnabled:!0};return`
                    <div class="flex items-center gap-3">
                        <input type="checkbox" data-pref-level="${t}" data-field="enabled" ${o.enabled?"checked":""} class="w-4 h-4 rounded border-[#3e415b] bg-transparent text-primary focus:ring-0">
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 rounded-sm bg-current ${f[o.color]}"></div>
                            <span class="text-sm font-bold ${f[o.color]}">${l.label}</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <input type="checkbox" data-pref-level="${t}" data-field="colorEnabled" ${o.colorEnabled?"checked":""} class="w-4 h-4 rounded border-[#3e415b] bg-transparent text-primary focus:ring-0">
                        <div class="flex items-center bg-[#1c1c28] border border-[#3e415b] rounded px-2 h-8 min-w-[120px]">
                           <select data-pref-level="${t}" data-field="color" class="bg-transparent border-none text-[11px] p-0 focus:ring-0 text-[#e1e1e6] cursor-pointer w-full font-bold">
                                ${C.map(s=>`<option value="${s}" ${o.color===s?"selected":""} class="bg-[#1c1c28]">${s}</option>`).join("")}
                           </select>
                           <span class="material-icons text-[14px] text-text-muted">expand_more</span>
                        </div>
                    </div>
                `}).join("")}function r(){localStorage.setItem("timber_settings_v10",JSON.stringify(e.settings))}function h(t,l="info"){n.toast.textContent=t,n.toast.className=`fixed top-4 left-1/2 -translate-x-1/2 z-[110] px-6 py-2 rounded-full text-[12px] font-bold shadow-2xl border backdrop-blur-md transition-all ${l==="error"?"bg-red-500/20 border-red-500/50 text-red-500":"bg-primary/20 border-primary/50 text-primary"}`,n.toast.classList.remove("hidden"),setTimeout(()=>n.toast.classList.add("hidden"),3e3)}async function L(){try{if(!navigator.serial)throw new Error("Web Serial not supported");e.port=await navigator.serial.requestPort(),await e.port.open({baudRate:parseInt(n.baudSelect.value)}),e.connected=!0,n.connectBtn.textContent="Disconnect",n.connectBtn.classList.replace("bg-primary","bg-red-500"),n.baudSelect.disabled=!0,S(),h("Connected","success")}catch(t){t.name!=="NotFoundError"&&t.name!=="AbortError"&&h(t.message,"error")}}async function B(){if(e.connected=!1,e.reader){try{await e.reader.cancel()}catch{}e.reader=null}if(e.port){try{await e.port.close()}catch{}e.port=null}n.connectBtn.textContent="Connect",n.connectBtn.classList.replace("bg-red-500","bg-primary"),n.baudSelect.disabled=!1,h("Disconnected")}async function S(){var o;const t=new TextDecoder;let l="";for(;(o=e.port)!=null&&o.readable&&e.connected;){e.reader=e.port.readable.getReader();try{for(;;){const{value:s,done:c}=await e.reader.read();if(c)break;if(l+=t.decode(s,{stream:!0}),l.includes(`
`)){const i=l.split(/\r?\n/);l=i.pop(),i.forEach(a=>{a.trim()&&w(a)})}}}catch{break}finally{e.reader.releaseLock()}}e.connected&&B()}function w(t){const l=new Date,o=l.toLocaleTimeString("en-US",{hour12:!1})+"."+String(l.getMilliseconds()).padStart(3,"0");let s="I",c=t;const i=t.match(/^([VDIWEA])\//)||t.match(/^\[([VDIWEA])\]/);if(i)s=i[1],c=t.replace(i[0],"").trim();else{const u=t.toUpperCase();u.includes("DEBUG")?s="D":u.includes("WARN")?s="W":u.includes("ERROR")?s="E":u.includes("WTF")?s="A":u.includes("VERBOSE")&&(s="V")}const a={id:Date.now()+Math.random(),ts:o,level:s,msg:c};e.logs.push(a),e.logs.length>5e3&&e.logs.shift();const g=e.settings.levelConfigs[s];g&&g.enabled&&p(a)}function p(t){var c,i;const l=document.createElement("div");l.className="log-grid log-row hover:bg-surface/20 group";const o=e.settings.levelConfigs[t.level],s=e.settings.appearanceMode==="custom"&&o&&o.colorEnabled?f[o.color]:(c=d[t.level])==null?void 0:c.color;l.innerHTML=`<div class="log-cell text-text-muted select-none text-[11px] ${e.settings.showTimestamp?"":"hidden"}">${t.ts}</div>
                             <div class="log-cell font-bold select-none text-[11px] ${s||""} ${e.settings.showLogLevel?"":"hidden"}">${((i=d[t.level])==null?void 0:i.label)||"INFO"}</div>
                             <div class="log-cell text-[#e1e1e6] break-all whitespace-pre-wrap selection:bg-primary selection:text-white leading-relaxed">${t.msg}</div>`,n.logContainer.appendChild(l),e.settings.autoScroll&&(n.logContainer.scrollTop=n.logContainer.scrollHeight)}async function y(){var o;if(!e.connected||!((o=e.port)!=null&&o.writable))return;const t=n.commandInput.value;if(!t.trim())return;const l=new TextEncoder;e.writer=e.port.writable.getWriter();try{if(e.settings.inputMode==="ASCII")await e.writer.write(l.encode(t+e.settings.lineEnding.replace("\\n",`
`).replace("\\r","\r")));else{const s=e.settings.hexBatchLines?t.split(/\r?\n/):[t];for(const c of s){const a=c.trim().replace(/[^0-9A-Fa-f]/g,"").match(/.{1,2}/g);a&&(await e.writer.write(new Uint8Array(a.map(g=>parseInt(g,16)))),e.settings.hexDelayEnabled&&s.length>1&&await new Promise(g=>setTimeout(g,e.settings.hexDelay)))}}n.commandInput.value=""}finally{e.writer.releaseLock()}}function b(){const t=e.settings.inputMode==="ASCII";n.modeAsciiBtn.className=`mode-pill ${t?"active":"inactive"}`,n.modeHexBtn.className=`mode-pill ${t?"inactive":"active"}`,n.asciiOptions.classList.toggle("hidden",!t),n.hexOptions.classList.toggle("hidden",t)}function v(){const t=[e.settings.showTimestamp?"140px":"0px",e.settings.showLogLevel?"100px":"0px","1fr"].join(" ");document.querySelectorAll(".log-grid").forEach(l=>l.style.gridTemplateColumns=t),n.headerTime.classList.toggle("hidden",!e.settings.showTimestamp),n.headerLevel.classList.toggle("hidden",!e.settings.showLogLevel)}function k(){n.connectBtn.onclick=()=>e.connected?B():L(),n.filterBtn.onclick=t=>{t.stopPropagation(),n.filterMenu.classList.toggle("hidden")},document.onclick=t=>{n.filterMenu.contains(t.target)||n.filterMenu.classList.add("hidden")},n.filterCheckboxes.onchange=t=>{const l=t.target.dataset.level;l&&(e.settings.levelConfigs[l].enabled=t.target.checked,r(),n.logContainer.innerHTML="",e.logs.forEach(o=>{var s;(s=e.settings.levelConfigs[o.level])!=null&&s.enabled&&p(o)}))},n.filterAllBtn.onclick=()=>{Object.keys(d).forEach(t=>e.settings.levelConfigs[t].enabled=!0),m(),r(),n.logContainer.innerHTML="",e.logs.forEach(t=>p(t))},n.filterNoneBtn.onclick=()=>{Object.keys(d).forEach(t=>e.settings.levelConfigs[t].enabled=!1),m(),r(),n.logContainer.innerHTML=""},n.clearBtn.onclick=()=>{e.logs=[],n.logContainer.innerHTML=""},n.saveBtn.onclick=()=>{const t=e.logs.filter(s=>{var c;return(c=e.settings.levelConfigs[s.level])==null?void 0:c.enabled}).map(s=>`[${s.ts}] [${d[s.level].label}] ${s.msg}`).join(`
`),l=new Blob([t],{type:"text/plain"}),o=document.createElement("a");o.href=URL.createObjectURL(l),o.download="timber_logs.txt",o.click()},n.modeAsciiBtn.onclick=()=>{e.settings.inputMode="ASCII",b(),r()},n.modeHexBtn.onclick=()=>{e.settings.inputMode="HEX",b(),r()},n.lineEndingSelect.onchange=()=>{e.settings.lineEnding=n.lineEndingSelect.value,r()},n.hexBatchLinesCheck.onchange=()=>{e.settings.hexBatchLines=n.hexBatchLinesCheck.checked,r()},n.hexDelayCheck.onchange=()=>{e.settings.hexDelayEnabled=n.hexDelayCheck.checked,r()},n.hexDelayInput.oninput=()=>{e.settings.hexDelay=parseInt(n.hexDelayInput.value)||0,r()},n.sendBtn.onclick=y,n.commandInput.onkeydown=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),y())},n.settingsBtn.onclick=()=>{n.prefUseSystemTimestamp.checked=e.settings.useSystemTimestamp,n.prefAutoConnect.checked=e.settings.autoConnect,e.settings.appearanceMode==="default"?n.prefAppearanceDefault.checked=!0:n.prefAppearanceCustom.checked=!0,x(),n.settingsModal.classList.remove("hidden")},n.closeSettingsBtn.onclick=n.cancelSettingsBtn.onclick=()=>n.settingsModal.classList.add("hidden"),n.doneSettingsBtn.onclick=()=>{e.settings.useSystemTimestamp=n.prefUseSystemTimestamp.checked,e.settings.autoConnect=n.prefAutoConnect.checked,e.settings.appearanceMode=n.prefAppearanceDefault.checked?"default":"custom",n.levelSettingsGrid.querySelectorAll("[data-pref-level]").forEach(t=>{const l=t.dataset.prefLevel,o=t.dataset.field;o==="enabled"||o==="colorEnabled"?e.settings.levelConfigs[l][o]=t.checked:o==="color"&&(e.settings.levelConfigs[l][o]=t.value)}),m(),v(),r(),n.logContainer.innerHTML="",e.logs.forEach(t=>{var l;(l=e.settings.levelConfigs[t.level])!=null&&l.enabled&&p(t)}),n.settingsModal.classList.add("hidden")}}I();
