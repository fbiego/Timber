(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const i of c)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(c){const i={};return c.integrity&&(i.integrity=c.integrity),c.referrerPolicy&&(i.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?i.credentials="include":c.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(c){if(c.ep)return;c.ep=!0;const i=s(c);fetch(c.href,i)}})();const d={D:{label:"DEBUG",color:"text-log-d",defaultColor:"Blue"},I:{label:"INFO",color:"text-log-i",defaultColor:"Green"},W:{label:"WARNING",color:"text-log-w",defaultColor:"Orange"},E:{label:"ERROR",color:"text-log-e",defaultColor:"Red"},V:{label:"VERBOSE",color:"text-log-v",defaultColor:"Cyan"},A:{label:"WTF",color:"text-log-a",defaultColor:"WTP"}},E=[1200,2400,4800,9600,19200,38400,57600,115200,230400,460800,921600],C=["Blue","Green","Red","Orange","Cyan","WTP"],p={Blue:"text-[#3b82f6]",Green:"text-[#22c55e]",Red:"text-[#ef4444]",Orange:"text-[#f59e0b]",Cyan:"text-[#2eaf9b]",WTP:"text-[#a855f7]"};let t={port:null,reader:null,writer:null,connected:!1,logs:[],settings:{baudRate:115200,showTimestamp:!0,showLogLevel:!0,autoScroll:!0,inputMode:"ASCII",lineEnding:`
`,hexBatchLines:!1,hexDelayEnabled:!0,hexDelay:100,useSystemTimestamp:!0,autoConnect:!0,appearanceMode:"default",levelConfigs:{D:{enabled:!0,color:"Blue",colorEnabled:!0},I:{enabled:!0,color:"Green",colorEnabled:!0},W:{enabled:!0,color:"Orange",colorEnabled:!0},E:{enabled:!0,color:"Red",colorEnabled:!0},V:{enabled:!0,color:"Cyan",colorEnabled:!0},A:{enabled:!0,color:"WTP",colorEnabled:!0}}}};const e={connectBtn:document.getElementById("connectBtn"),baudSelect:document.getElementById("baudRateSelect"),filterBtn:document.getElementById("filterBtn"),filterMenu:document.getElementById("filterMenu"),filterCheckboxes:document.getElementById("filterCheckboxes"),filterAllBtn:document.getElementById("filterAllBtn"),filterNoneBtn:document.getElementById("filterNoneBtn"),saveBtn:document.getElementById("saveBtn"),clearBtn:document.getElementById("clearBtn"),logContainer:document.getElementById("logContainer"),modeAsciiBtn:document.getElementById("modeAsciiBtn"),modeHexBtn:document.getElementById("modeHexBtn"),asciiOptions:document.getElementById("asciiOptions"),hexOptions:document.getElementById("hexOptions"),lineEndingSelect:document.getElementById("lineEndingSelect"),hexBatchLinesCheck:document.getElementById("hexBatchLinesCheck"),hexDelayCheck:document.getElementById("hexDelayCheck"),hexDelayInput:document.getElementById("hexDelayInput"),commandInput:document.getElementById("commandInput"),sendBtn:document.getElementById("sendBtn"),settingsBtn:document.getElementById("settingsBtn"),settingsModal:document.getElementById("settingsModal"),closeSettingsBtn:document.getElementById("closeSettingsBtn"),cancelSettingsBtn:document.getElementById("cancelSettingsBtn"),doneSettingsBtn:document.getElementById("doneSettingsBtn"),prefUseSystemTimestamp:document.getElementById("prefUseSystemTimestamp"),prefAutoConnect:document.getElementById("prefAutoConnect"),prefAppearanceDefault:document.getElementById("prefAppearanceDefault"),prefAppearanceCustom:document.getElementById("prefAppearanceCustom"),levelSettingsGrid:document.getElementById("levelSettingsGrid"),toast:document.getElementById("toast"),headerTime:document.getElementById("headerTime"),headerLevel:document.getElementById("headerLevel")};function r(){localStorage.setItem("timber_settings_v10",JSON.stringify(t.settings))}function h(n,l="info"){e.toast.textContent=n,e.toast.className=`fixed top-4 left-1/2 -translate-x-1/2 z-[110] px-6 py-2 rounded-full text-[12px] font-bold shadow-2xl border backdrop-blur-md transition-all ${l==="error"?"bg-red-500/20 border-red-500/50 text-red-500":"bg-primary/20 border-primary/50 text-primary"}`,e.toast.classList.remove("hidden"),setTimeout(()=>e.toast.classList.add("hidden"),2500)}function m(){e.filterCheckboxes.innerHTML=Object.entries(d).map(([n,l])=>{var s,o;return`
        <label class="flex items-center gap-3 px-2 py-2 rounded hover:bg-surface-light cursor-pointer group">
          <input type="checkbox" data-level="${n}" ${(s=t.settings.levelConfigs[n])!=null&&s.enabled?"checked":""} class="level-check w-4 h-4 bg-transparent border-border text-primary rounded focus:ring-0">
          <span class="text-[11px] font-bold ${p[((o=t.settings.levelConfigs[n])==null?void 0:o.color)||"Blue"]}">${l.label}</span>
        </label>
      `}).join("")}function x(){e.levelSettingsGrid.innerHTML=Object.entries(d).map(([n,l])=>{const s=t.settings.levelConfigs[n]||{enabled:!0,color:"Blue",colorEnabled:!0};return`
          <div class="flex items-center gap-3">
            <input type="checkbox" data-pref-level="${n}" data-field="enabled" ${s.enabled?"checked":""} class="w-4 h-4 rounded border-[#3e415b] bg-transparent text-primary focus:ring-0">
            <div class="flex items-center gap-2">
              <div class="w-4 h-4 rounded-sm bg-current ${p[s.color]}"></div>
              <span class="text-sm font-bold ${p[s.color]}">${l.label}</span>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <input type="checkbox" data-pref-level="${n}" data-field="colorEnabled" ${s.colorEnabled?"checked":""} class="w-4 h-4 rounded border-[#3e415b] bg-transparent text-primary focus:ring-0">
            <div class="flex items-center bg-[#1c1c28] border border-[#3e415b] rounded px-2 h-8 min-w-[120px]">
              <select data-pref-level="${n}" data-field="color" class="bg-transparent border-none text-[11px] p-0 focus:ring-0 text-[#e1e1e6] cursor-pointer w-full font-bold">
                ${C.map(o=>`<option value="${o}" ${s.color===o?"selected":""} class="bg-[#1c1c28]">${o}</option>`).join("")}
              </select>
              <span class="material-icons text-[14px] text-text-muted">expand_more</span>
            </div>
          </div>
        `}).join("")}async function L(){try{if(!navigator.serial)throw new Error("Web Serial not supported");t.port=await navigator.serial.requestPort(),await t.port.open({baudRate:parseInt(e.baudSelect.value)}),t.connected=!0,e.connectBtn.textContent="Disconnect",e.connectBtn.classList.remove("bg-primary","hover:bg-primary-hover"),e.connectBtn.classList.add("bg-red-500","hover:bg-red-600"),e.baudSelect.disabled=!0,I(),h("Connected")}catch(n){(n==null?void 0:n.name)!=="NotFoundError"&&(n==null?void 0:n.name)!=="AbortError"&&h(n.message||"Connect failed","error")}}async function B(){if(t.connected=!1,t.reader){try{await t.reader.cancel()}catch{}t.reader=null}if(t.port){try{await t.port.close()}catch{}t.port=null}e.connectBtn.textContent="Connect",e.connectBtn.classList.remove("bg-red-500","hover:bg-red-600"),e.connectBtn.classList.add("bg-primary","hover:bg-primary-hover"),e.baudSelect.disabled=!1,h("Disconnected")}async function I(){var s;const n=new TextDecoder;let l="";for(;(s=t.port)!=null&&s.readable&&t.connected;){t.reader=t.port.readable.getReader();try{for(;;){const{value:o,done:c}=await t.reader.read();if(c)break;if(l+=n.decode(o,{stream:!0}),l.includes(`
`)){const i=l.split(/\r?\n/);l=i.pop(),i.forEach(a=>{a.trim()&&S(a)})}}}catch{break}finally{try{t.reader.releaseLock()}catch{}}}t.connected&&B()}function S(n){const l=new Date,s=l.toLocaleTimeString("en-US",{hour12:!1})+"."+String(l.getMilliseconds()).padStart(3,"0");let o="I",c=n;const i=n.match(/^([VDIWEA])\//)||n.match(/^\[([VDIWEA])\]/);if(i)o=i[1],c=n.replace(i[0],"").trim();else{const u=n.toUpperCase();u.includes("DEBUG")?o="D":u.includes("WARN")?o="W":u.includes("ERROR")?o="E":u.includes("WTF")?o="A":u.includes("VERBOSE")&&(o="V")}const a={id:Date.now()+Math.random(),ts:s,level:o,msg:c};t.logs.push(a),t.logs.length>5e3&&t.logs.shift();const g=t.settings.levelConfigs[o];g&&g.enabled&&f(a)}function f(n){var c,i;const l=document.createElement("div");l.className="log-grid log-row hover:bg-surface/20 group";const s=t.settings.levelConfigs[n.level],o=t.settings.appearanceMode==="custom"&&s&&s.colorEnabled?p[s.color]:((c=d[n.level])==null?void 0:c.color)||"";l.innerHTML=`
        <div class="log-cell text-text-muted select-none text-[11px] ${t.settings.showTimestamp?"":"hidden"}">${n.ts}</div>
        <div class="log-cell font-bold select-none text-[11px] ${o} ${t.settings.showLogLevel?"":"hidden"}">${((i=d[n.level])==null?void 0:i.label)||"INFO"}</div>
        <div class="log-cell text-[#e1e1e6] break-all whitespace-pre-wrap selection:bg-primary selection:text-white leading-relaxed">${n.msg}</div>
      `,e.logContainer.appendChild(l),t.settings.autoScroll&&(e.logContainer.scrollTop=e.logContainer.scrollHeight)}async function y(){var s;if(!t.connected||!((s=t.port)!=null&&s.writable))return;const n=e.commandInput.value;if(!n.trim())return;const l=new TextEncoder;t.writer=t.port.writable.getWriter();try{if(t.settings.inputMode==="ASCII"){const o=t.settings.lineEnding.replace("\\n",`
`).replace("\\r","\r");await t.writer.write(l.encode(n+o))}else{const o=t.settings.hexBatchLines?n.split(/\r?\n/):[n];for(const c of o){const a=c.trim().replace(/[^0-9A-Fa-f]/g,"").match(/.{1,2}/g);a&&(await t.writer.write(new Uint8Array(a.map(g=>parseInt(g,16)))),t.settings.hexDelayEnabled&&o.length>1&&await new Promise(g=>setTimeout(g,t.settings.hexDelay)))}}e.commandInput.value=""}finally{try{t.writer.releaseLock()}catch{}}}function b(){const n=t.settings.inputMode==="ASCII";e.asciiOptions.classList.toggle("hidden",!n),e.hexOptions.classList.toggle("hidden",n),n?(e.modeAsciiBtn.classList.add("bg-surface-light"),e.modeHexBtn.classList.remove("bg-surface-light"),e.modeHexBtn.classList.add("bg-background"),e.modeAsciiBtn.classList.remove("bg-background")):(e.modeHexBtn.classList.add("bg-surface-light"),e.modeAsciiBtn.classList.remove("bg-surface-light"),e.modeAsciiBtn.classList.add("bg-background"),e.modeHexBtn.classList.remove("bg-background"))}function v(){const n=[t.settings.showTimestamp?"140px":"0px",t.settings.showLogLevel?"100px":"0px","1fr"].join(" ");document.querySelectorAll(".log-grid").forEach(l=>l.style.gridTemplateColumns=n),e.headerTime.classList.toggle("hidden",!t.settings.showTimestamp),e.headerLevel.classList.toggle("hidden",!t.settings.showLogLevel)}function k(){e.connectBtn.onclick=()=>t.connected?B():L(),e.filterBtn.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),e.filterMenu.classList.toggle("hidden")}),document.addEventListener("click",n=>{const l=e.filterMenu.contains(n.target),s=e.filterBtn.contains(n.target);!l&&!s&&e.filterMenu.classList.add("hidden")}),e.filterCheckboxes.onchange=n=>{const l=n.target.dataset.level;l&&(t.settings.levelConfigs[l].enabled=n.target.checked,r(),e.logContainer.innerHTML="",t.logs.forEach(s=>{var o;(o=t.settings.levelConfigs[s.level])!=null&&o.enabled&&f(s)}))},e.filterAllBtn.onclick=()=>{Object.keys(d).forEach(n=>t.settings.levelConfigs[n].enabled=!0),m(),r(),e.logContainer.innerHTML="",t.logs.forEach(n=>f(n))},e.filterNoneBtn.onclick=()=>{Object.keys(d).forEach(n=>t.settings.levelConfigs[n].enabled=!1),m(),r(),e.logContainer.innerHTML=""},e.clearBtn.onclick=()=>{t.logs=[],e.logContainer.innerHTML=""},e.saveBtn.onclick=()=>{const n=t.logs.filter(o=>{var c;return(c=t.settings.levelConfigs[o.level])==null?void 0:c.enabled}).map(o=>`[${o.ts}] [${d[o.level].label}] ${o.msg}`).join(`
`),l=new Blob([n],{type:"text/plain"}),s=document.createElement("a");s.href=URL.createObjectURL(l),s.download="timber_logs.txt",s.click()},e.modeAsciiBtn.onclick=()=>{t.settings.inputMode="ASCII",b(),r()},e.modeHexBtn.onclick=()=>{t.settings.inputMode="HEX",b(),r()},e.lineEndingSelect.onchange=()=>{t.settings.lineEnding=e.lineEndingSelect.value,r()},e.hexBatchLinesCheck.onchange=()=>{t.settings.hexBatchLines=e.hexBatchLinesCheck.checked,r()},e.hexDelayCheck.onchange=()=>{t.settings.hexDelayEnabled=e.hexDelayCheck.checked,r()},e.hexDelayInput.oninput=()=>{t.settings.hexDelay=parseInt(e.hexDelayInput.value)||0,r()},e.sendBtn.onclick=y,e.commandInput.onkeydown=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),y())},e.settingsBtn.onclick=()=>{e.prefUseSystemTimestamp.checked=t.settings.useSystemTimestamp,e.prefAutoConnect.checked=t.settings.autoConnect,t.settings.appearanceMode==="default"?e.prefAppearanceDefault.checked=!0:e.prefAppearanceCustom.checked=!0,x(),e.settingsModal.classList.remove("hidden")},e.closeSettingsBtn.onclick=e.cancelSettingsBtn.onclick=()=>{e.settingsModal.classList.add("hidden")},e.doneSettingsBtn.onclick=()=>{t.settings.useSystemTimestamp=e.prefUseSystemTimestamp.checked,t.settings.autoConnect=e.prefAutoConnect.checked,t.settings.appearanceMode=e.prefAppearanceDefault.checked?"default":"custom",e.levelSettingsGrid.querySelectorAll("[data-pref-level]").forEach(n=>{const l=n.dataset.prefLevel,s=n.dataset.field;s==="enabled"||s==="colorEnabled"?t.settings.levelConfigs[l][s]=n.checked:s==="color"&&(t.settings.levelConfigs[l][s]=n.value)}),m(),v(),r(),e.logContainer.innerHTML="",t.logs.forEach(n=>{var l;(l=t.settings.levelConfigs[n.level])!=null&&l.enabled&&f(n)}),e.settingsModal.classList.add("hidden")}}async function w(){const n=localStorage.getItem("timber_settings_v10");n&&(t.settings={...t.settings,...JSON.parse(n)}),e.baudSelect.innerHTML=E.map(l=>`<option value="${l}">${l}</option>`).join(""),e.baudSelect.value=t.settings.baudRate,e.lineEndingSelect.value=t.settings.lineEnding||"",e.hexBatchLinesCheck.checked=!!t.settings.hexBatchLines,e.hexDelayCheck.checked=!!t.settings.hexDelayEnabled,e.hexDelayInput.value=String(t.settings.hexDelay??100),m(),x(),b(),v(),k()}w();
