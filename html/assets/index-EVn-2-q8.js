(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function c(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}})();const u={V:{label:"VERBOSE",color:"text-log-v"},D:{label:"DEBUG",color:"text-log-d"},I:{label:"INFO",color:"text-log-i"},W:{label:"WARNING",color:"text-log-w"},E:{label:"ERROR",color:"text-log-e"},A:{label:"WTF",color:"text-log-a"}},E=[1200,2400,4800,9600,19200,38400,57600,115200,230400,460800,921600];let e={port:null,reader:null,writer:null,connected:!1,logs:[],settings:{baudRate:115200,activeLevels:Object.keys(u),showTimestamp:!0,showLogLevel:!0,showHorizontalGrid:!0,autoScroll:!0,inputMode:"ASCII",lineEnding:`
`,hexBatchLines:!1,hexDelay:10}};const t={connectBtn:document.getElementById("connectBtn"),baudSelect:document.getElementById("baudRateSelect"),filterBtn:document.getElementById("filterBtn"),filterMenu:document.getElementById("filterMenu"),filterCheckboxes:document.getElementById("filterCheckboxes"),filterAllBtn:document.getElementById("filterAllBtn"),filterNoneBtn:document.getElementById("filterNoneBtn"),saveBtn:document.getElementById("saveBtn"),clearBtn:document.getElementById("clearBtn"),autoScrollCheck:document.getElementById("autoScrollCheck"),logContainer:document.getElementById("logContainer"),logHeader:document.getElementById("logHeader"),modeAsciiBtn:document.getElementById("modeAsciiBtn"),modeHexBtn:document.getElementById("modeHexBtn"),asciiOptions:document.getElementById("asciiOptions"),hexOptions:document.getElementById("hexOptions"),lineEndingSelect:document.getElementById("lineEndingSelect"),hexBatchLinesCheck:document.getElementById("hexBatchLinesCheck"),hexDelayInput:document.getElementById("hexDelayInput"),commandInput:document.getElementById("commandInput"),sendBtn:document.getElementById("sendBtn"),settingsBtn:document.getElementById("settingsBtn"),settingsModal:document.getElementById("settingsModal"),closeSettingsBtn:document.getElementById("closeSettingsBtn"),doneSettingsBtn:document.getElementById("doneSettingsBtn"),prefShowTime:document.getElementById("prefShowTime"),prefShowLevel:document.getElementById("prefShowLevel"),prefShowGrid:document.getElementById("prefShowGrid"),toast:document.getElementById("toast")};function B(){const n=localStorage.getItem("timber_settings_v3");n&&(e.settings={...e.settings,...JSON.parse(n)}),t.baudSelect.innerHTML=E.map(s=>`<option value="${s}">${s}</option>`).join(""),t.baudSelect.value=e.settings.baudRate,t.filterCheckboxes.innerHTML=Object.entries(u).map(([s,i])=>`
                <label class="flex items-center gap-3 px-2 py-2 rounded hover:bg-surface-light cursor-pointer transition-colors group">
                    <input type="checkbox" data-level="${s}" ${e.settings.activeLevels.includes(s)?"checked":""} class="level-check w-4 h-4 bg-transparent border-border text-primary rounded focus:ring-0">
                    <span class="text-[11px] font-bold ${i.color}">${i.label}</span>
                </label>
            `).join(""),t.autoScrollCheck.checked=e.settings.autoScroll,t.prefShowTime.checked=e.settings.showTimestamp,t.prefShowLevel.checked=e.settings.showLogLevel,t.prefShowGrid.checked=e.settings.showHorizontalGrid,t.lineEndingSelect.value=e.settings.lineEnding,t.hexBatchLinesCheck.checked=e.settings.hexBatchLines,t.hexDelayInput.value=e.settings.hexDelay,h(),L(),y(),I()}function d(){localStorage.setItem("timber_settings_v3",JSON.stringify(e.settings))}function g(n,s="info"){t.toast.textContent=n,t.toast.className=`fixed top-4 left-1/2 -translate-x-1/2 z-[110] px-6 py-2 rounded-full text-[12px] font-bold shadow-2xl border backdrop-blur-md transition-all ${s==="error"?"bg-red-500/20 border-red-500/50 text-red-500":"bg-primary/20 border-primary/50 text-primary"}`,t.toast.classList.remove("hidden"),setTimeout(()=>t.toast.classList.add("hidden"),3e3)}async function b(){if(!navigator.serial){g("Web Serial not supported.","error");return}try{e.port=await navigator.serial.requestPort();const n=parseInt(t.baudSelect.value);await e.port.open({baudRate:n}),e.connected=!0,t.connectBtn.textContent="Disconnect",t.connectBtn.className=t.connectBtn.className.replace("bg-primary","bg-red-500").replace("hover:bg-primary-hover","hover:bg-red-600"),g("Connected to port","success"),x()}catch(n){n.name!=="NotFoundError"&&n.name!=="AbortError"&&g(`Connection failed: ${n.message}`,"error")}}async function f(){e.connected=!1,e.reader&&(await e.reader.cancel(),e.reader=null),e.port&&(await e.port.close(),e.port=null),t.connectBtn.textContent="Connect",t.connectBtn.className=t.connectBtn.className.replace("bg-red-500","bg-primary").replace("hover:bg-red-600","hover:bg-primary-hover"),g("Disconnected")}async function x(){const n=new TextDecoder;let s="";for(;e.port&&e.port.readable&&e.connected;){e.reader=e.port.readable.getReader();try{for(;;){const{value:i,done:c}=await e.reader.read();if(c)break;if(s+=n.decode(i,{stream:!0}),s.includes(`
`)){const o=s.split(/\r?\n/);s=o.pop(),o.forEach(l=>{l.trim()&&w(l)})}}}catch(i){console.warn("Read loop broken:",i);break}finally{e.reader.releaseLock()}}e.connected&&f()}function w(n){const s=new Date,i=s.toLocaleTimeString("en-US",{hour12:!1})+"."+String(s.getMilliseconds()).padStart(3,"0");let c="I",o=n;const l=n.match(/^([VDIWEA])\//)||n.match(/^\[([VDIWEA])\]/);if(l)c=l[1],o=n.replace(l[0],"").trim();else{const a=n.toUpperCase();a.includes("DEBUG")?c="D":a.includes("WARN")?c="W":a.includes("ERROR")||a.includes("FAIL")?c="E":a.includes("WTF")||a.includes("CRITICAL")?c="A":a.includes("VERBOSE")&&(c="V")}const r={id:Date.now()+Math.random(),timestamp:i,level:c,message:o};e.logs.push(r),e.logs.length>5e3&&e.logs.shift(),e.settings.activeLevels.includes(c)&&v(r)}function v(n){var l,r;const s=document.createElement("div");s.className="log-grid log-row px-5 py-2 hover:bg-surface/30 transition-colors group relative",s.dataset.level=n.level;const i=`<div class="log-time text-[#6c6d7e] select-none text-[11px] ${e.settings.showTimestamp?"":"hidden"}">${n.timestamp}</div>`,c=`<div class="log-level font-bold select-none text-[11px] ${((l=u[n.level])==null?void 0:l.color)||""} ${e.settings.showLogLevel?"":"hidden"}">${((r=u[n.level])==null?void 0:r.label)||"INFO"}</div>`,o=`<div class="text-[#e1e1e6] break-words whitespace-pre-wrap selection:bg-primary selection:text-white leading-6">${n.message}</div>`;s.innerHTML=i+c+o,t.logContainer.appendChild(s),e.settings.autoScroll&&(t.logContainer.scrollTop=t.logContainer.scrollHeight)}function m(){t.logContainer.innerHTML="",e.logs.filter(s=>e.settings.activeLevels.includes(s.level)).forEach(s=>v(s))}async function p(){if(!e.connected||!e.port||!e.port.writable){g("Serial port is not connected","error");return}const n=t.commandInput.value;if(!n.trim())return;const s=new TextEncoder;e.writer=e.port.writable.getWriter();try{if(e.settings.inputMode==="ASCII"){const i=e.settings.lineEnding.replace("\\n",`
`).replace("\\r","\r");await e.writer.write(s.encode(n+i))}else{const i=e.settings.hexBatchLines?n.split(/\r?\n/):[n];for(const c of i){const l=c.trim().replace(/[^0-9A-Fa-f]/g,"").match(/.{1,2}/g);if(l){const r=new Uint8Array(l.map(a=>parseInt(a,16)));await e.writer.write(r),e.settings.hexDelay>0&&i.length>1&&await new Promise(a=>setTimeout(a,e.settings.hexDelay))}}}t.commandInput.value="",g("Data transmitted","success")}catch(i){g(`Transmission failed: ${i.message}`,"error")}finally{e.writer.releaseLock()}}function h(){const n=e.settings.inputMode==="ASCII";t.modeAsciiBtn.className=`px-6 py-1.5 rounded-md text-[10px] font-bold transition-all ${n?"bg-surface-light text-[#f1f1f4] shadow-sm":"text-[#6c6d7e] hover:text-[#e1e1e6]"}`,t.modeHexBtn.className=`px-6 py-1.5 rounded-md text-[10px] font-bold transition-all ${n?"text-[#6c6d7e] hover:text-[#e1e1e6]":"bg-surface-light text-[#f1f1f4] shadow-sm"}`,t.asciiOptions.classList.toggle("hidden",!n),t.hexOptions.classList.toggle("hidden",n),t.commandInput.placeholder=n?"Type ASCII command here...":"Type HEX bytes here (e.g. AA 01 FF)..."}function L(){const n=[];e.settings.showTimestamp?n.push("120px"):n.push("0px"),e.settings.showLogLevel?n.push("100px"):n.push("0px"),n.push("1fr");const s=n.join(" ");document.querySelectorAll(".log-grid").forEach(i=>i.style.gridTemplateColumns=s),t.logHeader.children[0].classList.toggle("invisible",!e.settings.showTimestamp),t.logHeader.children[1].classList.toggle("invisible",!e.settings.showLogLevel),document.querySelectorAll(".log-time").forEach(i=>i.classList.toggle("hidden",!e.settings.showTimestamp)),document.querySelectorAll(".log-level").forEach(i=>i.classList.toggle("hidden",!e.settings.showLogLevel))}function y(){document.body.classList.toggle("show-grid",e.settings.showHorizontalGrid)}function I(){t.connectBtn.addEventListener("click",()=>e.connected?f():b()),t.baudSelect.addEventListener("change",()=>{e.settings.baudRate=parseInt(t.baudSelect.value),d()}),t.filterBtn.addEventListener("click",n=>{n.stopPropagation(),t.filterMenu.classList.toggle("hidden")}),document.addEventListener("click",n=>{t.filterMenu.contains(n.target)||t.filterMenu.classList.add("hidden")}),t.filterCheckboxes.addEventListener("change",n=>{if(n.target.classList.contains("level-check")){const s=n.target.dataset.level;n.target.checked?e.settings.activeLevels.includes(s)||e.settings.activeLevels.push(s):e.settings.activeLevels=e.settings.activeLevels.filter(i=>i!==s),d(),m()}}),t.filterAllBtn.addEventListener("click",()=>{e.settings.activeLevels=Object.keys(u),document.querySelectorAll(".level-check").forEach(n=>n.checked=!0),d(),m()}),t.filterNoneBtn.addEventListener("click",()=>{e.settings.activeLevels=[],document.querySelectorAll(".level-check").forEach(n=>n.checked=!1),d(),m()}),t.clearBtn.addEventListener("click",()=>{e.logs=[],t.logContainer.innerHTML="",g("Terminal cleared")}),t.saveBtn.addEventListener("click",()=>{const n=e.logs.filter(o=>e.settings.activeLevels.includes(o.level));if(n.length===0){g("Nothing to export","error");return}const s=n.map(o=>`${e.settings.showTimestamp?`[${o.timestamp}] `:""}${e.settings.showLogLevel?`[${u[o.level].label}] `:""}${o.message}`).join(`
`),i=new Blob([s],{type:"text/plain"}),c=document.createElement("a");c.href=URL.createObjectURL(i),c.download=`timber_export_${new Date().toISOString().slice(0,19).replace(/[:]/g,"-")}.txt`,c.click()}),t.autoScrollCheck.addEventListener("change",()=>{e.settings.autoScroll=t.autoScrollCheck.checked,d()}),t.modeAsciiBtn.addEventListener("click",()=>{e.settings.inputMode="ASCII",h(),d()}),t.modeHexBtn.addEventListener("click",()=>{e.settings.inputMode="HEX",h(),d()}),t.lineEndingSelect.addEventListener("change",()=>{e.settings.lineEnding=t.lineEndingSelect.value,d()}),t.hexBatchLinesCheck.addEventListener("change",()=>{e.settings.hexBatchLines=t.hexBatchLinesCheck.checked,d()}),t.hexDelayInput.addEventListener("input",()=>{e.settings.hexDelay=Math.max(0,parseInt(t.hexDelayInput.value)||0),d()}),t.sendBtn.addEventListener("click",p),t.commandInput.addEventListener("keydown",n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),p())}),t.settingsBtn.addEventListener("click",()=>t.settingsModal.classList.remove("hidden")),t.closeSettingsBtn.addEventListener("click",()=>t.settingsModal.classList.add("hidden")),t.doneSettingsBtn.addEventListener("click",()=>{e.settings.showTimestamp=t.prefShowTime.checked,e.settings.showLogLevel=t.prefShowLevel.checked,e.settings.showHorizontalGrid=t.prefShowGrid.checked,L(),y(),d(),t.settingsModal.classList.add("hidden")})}B();
